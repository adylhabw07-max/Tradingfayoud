<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø°ÙƒÙŠØ© - Smart Trading Tool</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'><text y=\'.9em\' font-size=\'90\'>ğŸ“ˆ</text></svg>">
    
    <!-- Chart.js Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .panel h2 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel h2::before {
            content: \'\';
            width: 4px;
            height: 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        .controls-panel {
            min-height: 600px;
        }
        
        .chart-panel {
            min-height: 600px;
        }
        
        .signals-panel {
            min-height: 600px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .control-group select,
        .control-group input,
        .control-group button {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #43e97b, #38f9d7);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-running {
            background: #4ade80;
        }
        
        .status-stopped {
            background: #ef4444;
        }
        
        .status-loading {
            background: #f59e0b;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }
        
        .signals-list {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .signal-item {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }
        
        .signal-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .signal-buy {
            border-left-color: #10b981;
        }
        
        .signal-sell {
            border-left-color: #ef4444;
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .signal-type {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .signal-time {
            font-size: 0.8rem;
            color: #666;
        }
        
        .signal-price {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
        }
        
        .signal-confidence {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }
        
        .confidence-bar {
            flex: 1;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
            transition: width 0.3s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .alert-error {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        
        .hidden {
            display: none !important;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .indicator-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .indicator-card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .indicator-name {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .indicator-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }
        
        .quality-gate-status {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .quality-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .metric {
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }
        
        .metric-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .panel {
                padding: 20px;
            }
            
            .indicators-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“ˆ Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø°ÙƒÙŠØ©</h1>
            <p>ØªØ­Ù„ÙŠÙ„ ÙÙ†ÙŠ Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ Ø¨ÙˆØ§Ø¨Ø© Ø¬ÙˆØ¯Ø© Ø°ÙƒÙŠØ© Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„</p>
        </div>
        
        <!-- Statistics Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalSignals">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="approvedSignals">0</div>
                <div class="stat-label">Ø¥Ø´Ø§Ø±Ø§Øª Ù…Ø¹ØªÙ…Ø¯Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="approvalRate">0%</div>
                <div class="stat-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="currentPrice">-</div>
                <div class="stat-label">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="priceChange">-</div>
                <div class="stat-label">Ø§Ù„ØªØºÙŠÙŠØ±</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="engineStatus">Ù…ØªÙˆÙ‚Ù</div>
                <div class="stat-label">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ</div>
            </div>
        </div>
        
        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Controls Panel -->
            <div class="panel controls-panel">
                <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„</h2>
                
                <div class="control-group">
                    <label for="pairSelect">Ø²ÙˆØ¬ Ø§Ù„Ø¹Ù…Ù„Ø§Øª:</label>
                    <select id="pairSelect">
                        <option value="EUR/USD">EUR/USD</option>
                        <option value="GBP/USD">GBP/USD</option>
                        <option value="USD/JPY">USD/JPY</option>
                        <option value="AUD/USD">AUD/USD</option>
                        <option value="USD/CAD">USD/CAD</option>
                        <option value="USD/CHF">USD/CHF</option>
                        <option value="NZD/USD">NZD/USD</option>
                        <option value="EUR/GBP">EUR/GBP</option>
                        <option value="EUR/JPY">EUR/JPY</option>
                        <option value="GBP/JPY">GBP/JPY</option>
                        <option value="BTC/USD">BTC/USD</option>
                        <option value="ETH/USD">ETH/USD</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="intervalSelect">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</label>
                    <select id="intervalSelect">
                        <option value="1min">1 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                        <option value="5min" selected>5 Ø¯Ù‚Ø§Ø¦Ù‚</option>
                        <option value="15min">15 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                        <option value="30min">30 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                        <option value="1h">1 Ø³Ø§Ø¹Ø©</option>
                        <option value="4h">4 Ø³Ø§Ø¹Ø§Øª</option>
                        <option value="1day">ÙŠÙˆÙ…ÙŠ</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="candlesInput">Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù…ÙˆØ¹:</label>
                    <input type="number" id="candlesInput" value="100" min="50" max="500">
                </div>
                
                <div class="control-group">
                    <button class="btn" id="startBtn">
                        <span id="startBtnText">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„</span>
                        <span id="startBtnSpinner" class="loading-spinner hidden"></span>
                    </button>
                </div>
                
                <div class="control-group">
                    <button class="btn btn-secondary" id="stopBtn" disabled>â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
                </div>
                
                <div class="control-group">
                    <button class="btn btn-success" id="refreshBtn">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                </div>
                
                <div class="control-group">
                    <button class="btn btn-warning" id="clearBtn">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª</button>
                </div>
                
                <!-- Auto Update Toggle -->
                <div class="control-group">
                    <label for="autoUpdateToggle">ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ:</label>
                    <input type="checkbox" id="autoUpdateToggle">
                </div>
            </div>
            
            <!-- Chart Panel -->
            <div class="panel chart-panel">
                <h2>ğŸ“Š Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ÙˆØ§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</h2>
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
                
                <div class="indicators-grid" id="indicatorsGrid">
                    <!-- Indicators will be dynamically loaded here -->
                </div>
            </div>
            
            <!-- Signals Panel -->
            <div class="panel signals-panel">
                <h2>ğŸ”” Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„</h2>
                >
                <div class="signals-list" id="signalsList">
                    <!-- Signals will be dynamically loaded here -->
                </div>
                
                <div class="quality-gate-status">
                    <h3>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©</h3>
                    <div class="quality-metrics">
                        <div class="metric">
                            <div class="metric-value" id="rejectedSignals">0</div>
                            <div class="metric-label">Ø¥Ø´Ø§Ø±Ø§Øª Ù…Ø±ÙÙˆØ¶Ø©</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="approvalRateQuality">0%</div>
                            <div class="metric-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Alerts Container -->
    <div id="alertContainer" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 90%; max-width: 500px;"></div>

    <!-- Include all modules -->
    <script src="data-fetcher.js"></script>
    <script src="technical-analysis.js"></script>
    <script src="quality-gate.js"></script>
    <script src="storage-manager.js"></script>
    <script src="backup-data.js"></script>
    <script src="trading-engine.js"></script>
    
    <script>
        let tradingEngine;
        let priceChart;
        let isRunning = false;

        // UI Elements
        const pairSelect = document.getElementById(\'pairSelect\');
        const intervalSelect = document.getElementById(\'intervalSelect\');
        const candlesInput = document.getElementById(\'candlesInput\');
        const startBtn = document.getElementById(\'startBtn\');
        const stopBtn = document.getElementById(\'stopBtn\');
        const refreshBtn = document.getElementById(\'refreshBtn\');
        const clearBtn = document.getElementById(\'clearBtn\');
        const autoUpdateToggle = document.getElementById(\'autoUpdateToggle\');
        const signalsList = document.getElementById(\'signalsList\');
        const indicatorsGrid = document.getElementById(\'indicatorsGrid\');
        const alertContainer = document.getElementById(\'alertContainer\');

        // Stats Elements
        const totalSignalsEl = document.getElementById(\'totalSignals\');
        const approvedSignalsEl = document.getElementById(\'approvedSignals\');
        const approvalRateEl = document.getElementById(\'approvalRate\');
        const currentPriceEl = document.getElementById(\'currentPrice\');
        const priceChangeEl = document.getElementById(\'priceChange\');
        const engineStatusEl = document.getElementById(\'engineStatus\');
        const rejectedSignalsEl = document.getElementById(\'rejectedSignals\');
        const approvalRateQualityEl = document.getElementById(\'approvalRateQuality\');

        /**
         * Show alert message
         */
        function showAlert(message, type = \'info\', duration = 5000) {
            const alertDiv = document.createElement(\'div\');
            alertDiv.className = `alert alert-${type} fade-in`;
            alertDiv.textContent = message;
            alertContainer.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.classList.remove(\'fade-in\');
                alertDiv.classList.add(\'hidden\');
                setTimeout(() => alertDiv.remove(), 500); // Remove after fade out
            }, duration);
        }

        /**
         * Set loading state for buttons
         */
        function setLoadingState(loading) {
            startBtn.disabled = loading;
            stopBtn.disabled = !loading;
            refreshBtn.disabled = loading;
            candlesInput.disabled = loading;
            pairSelect.disabled = loading;
            intervalSelect.disabled = loading;
            autoUpdateToggle.disabled = loading;

            document.getElementById(\'startBtnText\').classList.toggle(\'hidden\', loading);
            document.getElementById(\'startBtnSpinner\').classList.toggle(\'hidden\', !loading);
            engineStatusEl.textContent = loading ? \'ÙŠØ¹Ù…Ù„...\' : (isRunning ? \'ÙŠØ¹Ù…Ù„\' : \'Ù…ØªÙˆÙ‚Ù\');
            engineStatusEl.className = loading ? \'status-loading\' : (isRunning ? \'status-running\' : \'status-stopped\');
        }

        /**
         * Initialize Chart.js
         */
        function initializeChart(labels = [], data = []) {
            const ctx = document.getElementById(\'priceChart\').getContext(\'2d\');
            if (priceChart) {
                priceChart.destroy(); // Destroy existing chart if any
            }
            priceChart = new Chart(ctx, {
                type: \'line\',
                data: {
                    labels: labels,
                    datasets: [{
                        label: \'Ø§Ù„Ø³Ø¹Ø±\',
                        data: data,
                        borderColor: \'#667eea\',
                        backgroundColor: \'rgba(102, 126, 234, 0.2)\',
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            type: \'time\',
                            time: {
                                displayFormats: {
                                    minute: \'HH:mm\',
                                    hour: \'HH:mm\'
                                }
                            }
                        },
                        y: {
                            beginAtZero: false
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: \'index\'
                    }
                }
            });
        }
        
        /**
         * Start analysis
         */
        async function startAnalysis() {
            if (isRunning) return;
            
            const pair = pairSelect.value;
            const interval = intervalSelect.value;
            const candles = parseInt(candlesInput.value);
            const autoUpdate = autoUpdateToggle.checked;
            
            // Update UI
            setLoadingState(true);
            showAlert(\'Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„...\', \'warning\');
            
            try {
                await tradingEngine.start(pair, interval, {
                    outputsize: candles,
                    enableAutoUpdate: autoUpdate
                });
                isRunning = true;
                setLoadingState(false);
                showAlert(\'ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!\', \'success\');
            } catch (error) {
                setLoadingState(false);
                showAlert(`Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„: ${error.message}`, \'error\');
                console.error(\'Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„:\', error);
            }
        }

        /**
         * Stop analysis
         */
        function stopAnalysis() {
            if (!isRunning) return;
            tradingEngine.stop();
            isRunning = false;
            setLoadingState(false);
            showAlert(\'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ù„ÙŠÙ„.\', \'info\');
        }

        /**
         * Refresh data
         */
        async function refreshData() {
            if (!isRunning) {
                showAlert(\'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.\', \'info\');
                return;
            }
            setLoadingState(true);
            showAlert(\'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...\', \'warning\');
            try {
                await tradingEngine.performAnalysis(tradingEngine.state.currentPair, tradingEngine.state.currentInterval, parseInt(candlesInput.value));
                setLoadingState(false);
                showAlert(\'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!\', \'success\');
            } catch (error) {
                setLoadingState(false);
                showAlert(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`, \'error\');
                console.error(\'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\', error);
            }
        }

        /**
         * Clear signals
         */
        function clearSignals() {
            tradingEngine.clearActiveSignals();
            signalsList.innerHTML = \'\';
            updateStats();
            showAlert(\'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª.\', \'info\');
        }

        /**
         * Update UI with latest analysis data
         */
        function updateUI(analysisData) {
            if (!analysisData || !analysisData.indicators) return;

            const { indicators, evaluations, approvedSignals, potentialSignals, candlesCount } = analysisData;

            // Update Chart
            const labels = analysisData.candles.map(c => new Date(c.datetime));
            const data = analysisData.candles.map(c => c.close);
            priceChart.data.labels = labels;
            priceChart.data.datasets[0].data = data;
            priceChart.update();

            // Update Indicators Grid
            indicatorsGrid.innerHTML = \'\';
            const indicatorValues = {
                \"RSI\": indicators.rsi ? indicators.rsi.toFixed(2) : \'N/A\',
                \"MACD Hist\": indicators.macdHistogram ? indicators.macdHistogram.toFixed(4) : \'N/A\',
                \"EMA12\": indicators.ema12 ? indicators.ema12.toFixed(4) : \'N/A\',
                \"EMA26\": indicators.ema26 ? indicators.ema26.toFixed(4) : \'N/A\',
                \"EMA50\": indicators.ema50 ? indicators.ema50.toFixed(4) : \'N/A\',
                \"BB Upper\": indicators.bbUpper ? indicators.bbUpper.toFixed(4) : \'N/A\',
                \"BB Middle\": indicators.bbMiddle ? indicators.bbMiddle.toFixed(4) : \'N/A\',
                \"BB Lower\": indicators.bbLower ? indicators.bbLower.toFixed(4) : \'N/A\',
                \"ATR\": indicators.atr ? indicators.atr.toFixed(4) : \'N/A\',
                \"Stoch K\": indicators.stochasticK ? indicators.stochasticK.toFixed(2) : \'N/A\',
                \"Stoch D\": indicators.stochasticD ? indicators.stochasticD.toFixed(2) : \'N/A\'
            };

            for (const key in indicatorValues) {
                const card = document.createElement(\'div\');
                card.className = \'indicator-card\';
                card.innerHTML = `
                    <div class=\'indicator-name\'>${key}</div>
                    <div class=\'indicator-value\'>${indicatorValues[key]}</div>
                `;
                indicatorsGrid.appendChild(card);
            }

            // Update Signals List
            signalsList.innerHTML = \'\';
            const latestSignals = tradingEngine.getActiveSignals(10); // Get latest 10 signals
            latestSignals.forEach(signal => {
                const signalItem = document.createElement(\'div\');
                signalItem.className = `signal-item ${signal.direction === \'buy\' ? \'signal-buy\' : \'signal-sell\'} fade-in`;
                signalItem.innerHTML = `
                    <div class=\'signal-header\'>
                        <div class=\'signal-type\'>${signal.direction === \'buy\' ? \'Ø´Ø±Ø§Ø¡ â¬†ï¸\' : \'Ø¨ÙŠØ¹ â¬‡ï¸\'} - ${signal.source}</div>
                        <div class=\'signal-time\'>${new Date(signal.timestamp).toLocaleTimeString(\'ar-EG\', { hour: \'2-digit\', minute: \'2-digit\', second: \'2-digit\'})}</div>
                    </div>
                    <div class=\'signal-price\'>Ø§Ù„Ø³Ø¹Ø±: ${signal.price.toFixed(5)}</div>
                    <div class=\'signal-reason\'>Ø§Ù„Ø³Ø¨Ø¨: ${signal.reason}</div>
                    <div class=\'signal-confidence\'>
                        <span>Ø§Ù„Ø«Ù‚Ø©: ${signal.confidence.toFixed(2)}%</span>
                        <div class=\'confidence-bar\'>
                            <div class=\'confidence-fill\' style=\'width: ${signal.confidence}%;\'></div>
                        </div>
                    </div>
                `;
                signalsList.appendChild(signalItem);
            });

            // Update Stats
            updateStats();
        }

        /**
         * Update general statistics
         */
        function updateStats() {
            const status = tradingEngine.getStatus();
            totalSignalsEl.textContent = status.qualityGateStats.totalEvaluated;
            approvedSignalsEl.textContent = status.qualityGateStats.totalApproved;
            approvalRateEl.textContent = status.qualityGateStats.approvalRate.toFixed(2) + \'%\';
            rejectedSignalsEl.textContent = status.qualityGateStats.totalRejected;
            approvalRateQualityEl.textContent = status.qualityGateStats.approvalRate.toFixed(2) + \'%\';

            if (status.lastAnalysis && status.lastAnalysis.candlesCount > 0) {
                const lastCandle = status.lastAnalysis.candles[status.lastAnalysis.candlesCount - 1];
                const prevCandle = status.lastAnalysis.candles[status.lastAnalysis.candlesCount - 2];
                currentPriceEl.textContent = lastCandle.close.toFixed(5);
                if (prevCandle) {
                    const change = ((lastCandle.close - prevCandle.close) / prevCandle.close) * 100;
                    priceChangeEl.textContent = `${change.toFixed(2)}%`;
                    priceChangeEl.style.color = change >= 0 ? \'#10b981\' : \'#ef4444\';
                }
            } else {
                currentPriceEl.textContent = \'-\
';
                priceChangeEl.textContent = \'-\
';
                priceChangeEl.style.color = \'#333\';
            }

            engineStatusEl.textContent = status.isRunning ? \'ÙŠØ¹Ù…Ù„\' : \'Ù…ØªÙˆÙ‚Ù\';
            engineStatusEl.className = status.isRunning ? \'status-running\' : \'status-stopped\';
        }

        // Event Listeners for buttons
        startBtn.addEventListener(\'click\', startAnalysis);
        stopBtn.addEventListener(\'click\', stopAnalysis);
        refreshBtn.addEventListener(\'click\', refreshData);
        clearBtn.addEventListener(\'click\', clearSignals);

        // Initialize on DOMContentLoaded
        document.addEventListener(\'DOMContentLoaded\', () => {
            tradingEngine = new SmartTradingEngine();
            initializeChart();
            updateStats(); // Initial UI update

            // Subscribe to engine events
            tradingEngine.on(\'analysis\', (data) => {
                updateUI(data);
            });
            tradingEngine.on(\'signal\', (signal) => {
                // Signal will be added via updateUI, but can be used for real-time notifications
                console.log(\'New Signal:\', signal);
            });
            tradingEngine.on(\'error\', (error) => {
                showAlert(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ùƒ: ${error.message}`, \'error\');
                console.error(\'Engine Error:\', error);
            });
            tradingEngine.on(\'update\', (data) => {
                console.log(\'Engine Update:\', data);
                if (data.type === \'engine_started\') {
                    setLoadingState(false);
                    isRunning = true;
                    stopBtn.disabled = false;
                    startBtn.disabled = true;
                } else if (data.type === \'engine_stopped\') {
                    setLoadingState(false);
                    isRunning = false;
                    stopBtn.disabled = true;
                    startBtn.disabled = false;
                }
            });
    </script>
</body>
</html>
