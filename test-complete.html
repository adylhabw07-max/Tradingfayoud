<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ - Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .test-result {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .test-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .test-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        .test-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ - Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø°ÙƒÙŠØ©</h1>
            <p>ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù</p>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
            <button class="btn" onclick="testComponents()">ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª</button>
            <div id="componentTests"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
            <button class="btn" onclick="testDataFetching()">Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <div id="dataTests"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ˆ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ</h2>
            <button class="btn" onclick="testTechnicalAnalysis()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ</button>
            <div id="analysisTests"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ›¡ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©</h2>
            <button class="btn" onclick="testQualityGate()">Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©</button>
            <div id="qualityTests"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ’¾ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ</h2>
            <button class="btn" onclick="testStorage()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ®Ø²ÙŠÙ†</button>
            <div id="storageTests"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸš€ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„</h2>
            <button class="btn" onclick="testFullEngine()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„</button>
            <div id="engineTests"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
            <div class="stats-grid" id="testStats">
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="passedTests">0</div>
                    <div class="stat-label">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø§Ø¬Ø­Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failedTests">0</div>
                    <div class="stat-label">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙØ§Ø´Ù„Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Include all modules -->
    <script src="data-fetcher.js"></script>
    <script src="technical-analysis.js"></script>
    <script src="quality-gate.js"></script>
    <script src="storage-manager.js"></script>
    <script src="backup-data.js"></script>
    <script src="trading-engine.js"></script>
    
    <script>
        // Test statistics
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0
        };
        
        /**
         * Add test result
         */
        function addTestResult(container, testName, success, message, details = null) {
            testStats.total++;
            if (success) {
                testStats.passed++;
            } else {
                testStats.failed++;
            }
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'test-success' : 'test-error'}`;
            
            let content = `${success ? 'âœ…' : 'âŒ'} ${testName}: ${message}`;
            if (details) {
                content += `\n${JSON.stringify(details, null, 2)}`;
            }
            
            resultDiv.textContent = content;
            document.getElementById(container).appendChild(resultDiv);
            
            updateTestStats();
        }
        
        /**
         * Add info message
         */
        function addInfo(container, message) {
            const infoDiv = document.createElement('div');
            infoDiv.className = 'test-result test-info';
            infoDiv.textContent = `â„¹ï¸ ${message}`;
            document.getElementById(container).appendChild(infoDiv);
        }
        
        /**
         * Update test statistics
         */
        function updateTestStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;
            
            const successRate = testStats.total > 0 ? 
                Math.round((testStats.passed / testStats.total) * 100) : 0;
            document.getElementById('successRate').textContent = `${successRate}%`;
        }
        
        /**
         * Test components loading
         */
        function testComponents() {
            const container = 'componentTests';
            document.getElementById(container).innerHTML = '';
            
            addInfo(container, 'Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª...');
            
            // Test DataFetcher
            try {
                const fetcher = new DataFetcher();
                addTestResult(container, 'DataFetcher', true, 'ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙˆØ­Ø¯Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                addTestResult(container, 'DataFetcher', false, `ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ÙˆØ­Ø¯Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`);
            }
            
            // Test TechnicalAnalysis
            try {
                const analysis = new TechnicalAnalysis();
                addTestResult(container, 'TechnicalAnalysis', true, 'ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                addTestResult(container, 'TechnicalAnalysis', false, `ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ: ${error.message}`);
            }
            
            // Test QualityGate
            try {
                const qualityGate = new QualityGate();
                addTestResult(container, 'QualityGate', true, 'ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙˆØ­Ø¯Ø© Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                addTestResult(container, 'QualityGate', false, `ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ÙˆØ­Ø¯Ø© Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©: ${error.message}`);
            }
            
            // Test StorageManager
            try {
                const storage = new StorageManager();
                addTestResult(container, 'StorageManager', true, 'ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙˆØ­Ø¯Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                addTestResult(container, 'StorageManager', false, `ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ÙˆØ­Ø¯Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†: ${error.message}`);
            }
            
            // Test BackupDataGenerator
            try {
                const backupGen = new BackupDataGenerator();
                addTestResult(container, 'BackupDataGenerator', true, 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                addTestResult(container, 'BackupDataGenerator', false, `ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ${error.message}`);
            }
            
            // Test SmartTradingEngine
            try {
                const engine = new SmartTradingEngine();
                addTestResult(container, 'SmartTradingEngine', true, 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                addTestResult(container, 'SmartTradingEngine', false, `ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒÙŠ: ${error.message}`);
            }
        }
        
        /**
         * Test data fetching
         */
        async function testDataFetching() {
            const container = 'dataTests';
            document.getElementById(container).innerHTML = '';
            
            addInfo(container, 'Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
            
            try {
                const fetcher = new DataFetcher();
                
                // Test backup data
                const backupGen = new BackupDataGenerator();
                const backupData = backupGen.getBackupData('EUR/USD', '5min', 50);
                
                if (backupData && backupData.values && backupData.values.length > 0) {
                    addTestResult(container, 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', true, 
                        `ØªÙ… Ø¬Ù„Ø¨ ${backupData.values.length} Ø´Ù…Ø¹Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©`);
                } else {
                    addTestResult(container, 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', false, 'ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
                }
                
                // Test supported pairs
                const supportedPairs = backupGen.getSupportedPairs();
                addTestResult(container, 'Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©', true, 
                    `ÙŠØªÙ… Ø¯Ø¹Ù… ${supportedPairs.length} Ø²ÙˆØ¬ Ø¹Ù…Ù„Ø§Øª`, supportedPairs.slice(0, 5));
                
            } catch (error) {
                addTestResult(container, 'Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', false, `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`);
            }
        }
        
        /**
         * Test technical analysis
         */
        function testTechnicalAnalysis() {
            const container = 'analysisTests';
            document.getElementById(container).innerHTML = '';
            
            addInfo(container, 'Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ...');
            
            try {
                const analysis = new TechnicalAnalysis();
                const backupGen = new BackupDataGenerator();
                const data = backupGen.getBackupData('EUR/USD', '5min', 100);
                
                if (!data || !data.values || data.values.length < 50) {
                    addTestResult(container, 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„', false, 'Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ© Ù„Ù„ØªØ­Ù„ÙŠÙ„');
                    return;
                }
                
                // Test RSI calculation
                const rsi = analysis.calculateRSI(data.values);
                if (rsi && rsi.length > 0) {
                    const lastRSI = rsi[rsi.length - 1];
                    addTestResult(container, 'Ø­Ø³Ø§Ø¨ RSI', true, 
                        `Ø¢Ø®Ø± Ù‚ÙŠÙ…Ø© RSI: ${lastRSI.toFixed(2)}`);
                } else {
                    addTestResult(container, 'Ø­Ø³Ø§Ø¨ RSI', false, 'ÙØ´Ù„ ÙÙŠ Ø­Ø³Ø§Ø¨ RSI');
                }
                
                // Test MACD calculation
                const macd = analysis.calculateMACD(data.values);
                if (macd && macd.histogram && macd.histogram.length > 0) {
                    const lastMACD = macd.histogram[macd.histogram.length - 1];
                    addTestResult(container, 'Ø­Ø³Ø§Ø¨ MACD', true, 
                        `Ø¢Ø®Ø± Ù‚ÙŠÙ…Ø© MACD Histogram: ${lastMACD.toFixed(6)}`);
                } else {
                    addTestResult(container, 'Ø­Ø³Ø§Ø¨ MACD', false, 'ÙØ´Ù„ ÙÙŠ Ø­Ø³Ø§Ø¨ MACD');
                }
                
                // Test EMA calculation
                const ema12 = analysis.calculateEMA(data.values, 12);
                if (ema12 && ema12.length > 0) {
                    const lastEMA = ema12[ema12.length - 1];
                    addTestResult(container, 'Ø­Ø³Ø§Ø¨ EMA', true, 
                        `Ø¢Ø®Ø± Ù‚ÙŠÙ…Ø© EMA(12): ${lastEMA.toFixed(5)}`);
                } else {
                    addTestResult(container, 'Ø­Ø³Ø§Ø¨ EMA', false, 'ÙØ´Ù„ ÙÙŠ Ø­Ø³Ø§Ø¨ EMA');
                }
                
                // Test Bollinger Bands
                const bb = analysis.calculateBollingerBands(data.values);
                if (bb && bb.upper && bb.upper.length > 0) {
                    const lastUpper = bb.upper[bb.upper.length - 1];
                    const lastLower = bb.lower[bb.lower.length - 1];
                    addTestResult(container, 'Ø­Ø³Ø§Ø¨ Bollinger Bands', true, 
                        `Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù„ÙˆÙŠ: ${lastUpper.toFixed(5)}, Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø³ÙÙ„ÙŠ: ${lastLower.toFixed(5)}`);
                } else {
                    addTestResult(container, 'Ø­Ø³Ø§Ø¨ Bollinger Bands', false, 'ÙØ´Ù„ ÙÙŠ Ø­Ø³Ø§Ø¨ Bollinger Bands');
                }
                
                // Test complete analysis
                const completeAnalysis = analysis.performCompleteAnalysis(data.values);
                if (completeAnalysis && completeAnalysis.indicators) {
                    addTestResult(container, 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„', true, 
                        'ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­', {
                            rsi: completeAnalysis.indicators.rsi,
                            macdHistogram: completeAnalysis.indicators.macdHistogram,
                            price: completeAnalysis.indicators.price
                        });
                } else {
                    addTestResult(container, 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„', false, 'ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„');
                }
                
            } catch (error) {
                addTestResult(container, 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ', false, `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ: ${error.message}`);
            }
        }
        
        /**
         * Test quality gate
         */
        function testQualityGate() {
            const container = 'qualityTests';
            document.getElementById(container).innerHTML = '';
            
            addInfo(container, 'Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©...');
            
            try {
                const qualityGate = new QualityGate();
                const analysis = new TechnicalAnalysis();
                const backupGen = new BackupDataGenerator();
                const data = backupGen.getBackupData('EUR/USD', '5min', 100);
                
                if (!data || !data.values || data.values.length < 50) {
                    addTestResult(container, 'Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©', false, 'Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ©');
                    return;
                }
                
                const completeAnalysis = analysis.performCompleteAnalysis(data.values);
                
                // Create test signal
                const testSignal = {
                    type: 'technical',
                    direction: 'buy',
                    price: completeAnalysis.indicators.price,
                    reason: 'Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©',
                    timestamp: new Date().toISOString()
                };
                
                // Test signal evaluation
                const evaluation = qualityGate.evaluateSignal(testSignal, completeAnalysis);
                
                if (evaluation) {
                    addTestResult(container, 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ø´Ø§Ø±Ø©', true, 
                        `ØªÙ… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ø´Ø§Ø±Ø© - Ø§Ù„Ø«Ù‚Ø©: ${evaluation.confidence}%`, {
                            approved: evaluation.approved,
                            confidence: evaluation.confidence,
                            reasons: evaluation.reasons.slice(0, 3)
                        });
                } else {
                    addTestResult(container, 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ø´Ø§Ø±Ø©', false, 'ÙØ´Ù„ ÙÙŠ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ø´Ø§Ø±Ø©');
                }
                
                // Test quality criteria
                const criteria = qualityGate.checkQualityCriteria(testSignal, completeAnalysis);
                addTestResult(container, 'Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø©', true, 
                    `ØªÙ… ÙØ­Øµ ${Object.keys(criteria).length} Ù…Ø¹ÙŠØ§Ø± Ø¬ÙˆØ¯Ø©`);
                
                // Test statistics
                const stats = qualityGate.getStats();
                addTestResult(container, 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©', true, 
                    'ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', stats);
                
            } catch (error) {
                addTestResult(container, 'Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©', false, `Ø®Ø·Ø£ ÙÙŠ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©: ${error.message}`);
            }
        }
        
        /**
         * Test storage
         */
        async function testStorage() {
            const container = 'storageTests';
            document.getElementById(container).innerHTML = '';
            
            addInfo(container, 'Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ...');
            
            try {
                const storage = new StorageManager();
                
                // Test basic storage
                const testData = { test: 'data', timestamp: Date.now() };
                await storage.set('test_key', testData);
                
                const retrievedData = await storage.get('test_key');
                if (retrievedData && retrievedData.test === 'data') {
                    addTestResult(container, 'Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ', true, 'ØªÙ… Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    addTestResult(container, 'Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ', false, 'ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø£Ùˆ Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
                // Test cache functionality
                await storage.setCache('cache_test', { cached: true }, 60); // 60 seconds
                const cachedData = await storage.getCache('cache_test');
                
                if (cachedData && cachedData.cached === true) {
                    addTestResult(container, 'Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª', true, 'ØªÙ… Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    addTestResult(container, 'Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª', false, 'ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª');
                }
                
                // Test statistics
                const stats = storage.getStats();
                addTestResult(container, 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†', true, 
                    'ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†', {
                        totalItems: stats.totalItems,
                        totalSize: stats.totalSize,
                        cacheHits: stats.cacheHits
                    });
                
                // Test cleanup
                await storage.cleanup();
                addTestResult(container, 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ®Ø²ÙŠÙ†', true, 'ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©');
                
            } catch (error) {
                addTestResult(container, 'Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ', false, `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†: ${error.message}`);
            }
        }
        
        /**
         * Test full engine
         */
        async function testFullEngine() {
            const container = 'engineTests';
            document.getElementById(container).innerHTML = '';
            
            addInfo(container, 'Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„...');
            
            try {
                const engine = new SmartTradingEngine();
                
                // Test engine initialization
                addTestResult(container, 'ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ', true, 'ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ Ø¨Ù†Ø¬Ø§Ø­');
                
                // Test engine status
                const initialStatus = engine.getStatus();
                addTestResult(container, 'Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ', true, 
                    'ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ', {
                        isRunning: initialStatus.isRunning,
                        currentPair: initialStatus.currentPair
                    });
                
                // Test analysis with backup data
                const analysisResult = await engine.performAnalysis('EUR/USD', '5min', 100);
                
                if (analysisResult && analysisResult.indicators) {
                    addTestResult(container, 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', true, 
                        'ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', {
                            price: analysisResult.indicators.price,
                            rsi: analysisResult.indicators.rsi,
                            macdHistogram: analysisResult.indicators.macdHistogram
                        });
                } else {
                    addTestResult(container, 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', false, 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
                // Test signal generation (if any)
                const signals = engine.getActiveSignals();
                addTestResult(container, 'Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©', true, 
                    `Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©: ${signals.length}`);
                
                // Test engine statistics
                const finalStatus = engine.getStatus();
                addTestResult(container, 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø±Ùƒ', true, 
                    'ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø±Ùƒ', {
                        totalAnalyses: finalStatus.totalAnalyses,
                        totalSignals: finalStatus.totalSignals,
                        lastUpdate: finalStatus.lastUpdate
                    });
                
            } catch (error) {
                addTestResult(container, 'Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„', false, `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ùƒ: ${error.message}`);
            }
        }
        
        // Auto-run component tests on load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                testComponents();
            }, 1000);
        });
    </script>
</body>
</html>

